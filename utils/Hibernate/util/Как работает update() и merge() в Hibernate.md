## **1๏ธโฃ ะะฐะบย`update()`ยะพััะปะตะถะธะฒะฐะตั ะธะทะผะตะฝะตะฝะธั?**

ะะตัะพะดย`update()`ยะฟะตัะตะฒะพะดะธัย**ะพััะพะตะดะธะฝัะฝะฝัะน (detached) ะพะฑัะตะบั ะฒ ัะฟัะฐะฒะปัะตะผะพะต ัะพััะพัะฝะธะต (persistent)**.

๐ย**ะัะธะผะตั**:
```java
Session session1 = HibernateUtil.getSessionFactory().openSession();
Transaction transaction1 = session1.beginTransaction();

User user = session1.get(User.class, 1); // ะะฐะณััะถะฐะตะผ ะพะฑัะตะบั
session1.close(); // ะะฐะบััะฒะฐะตะผ ัะตััะธั, ะพะฑัะตะบั ััะฐะฝะพะฒะธััั "detached"

// ะะทะผะตะฝัะตะผ ะพะฑัะตะบั ะฒ ะฟะฐะผััะธ
user.setName("ะะพะฒะพะต ะธะผั");

Session session2 = HibernateUtil.getSessionFactory().openSession();
Transaction transaction2 = session2.beginTransaction();

session2.update(user); // ะะตัะตะฒะพะดะธะผ ะพะฑัะตะบั ะฒ managed-ัะพััะพัะฝะธะต
transaction2.commit(); // Hibernate ะพัะฟัะฐะฒะธั UPDATE ะฒ ะะ
session2.close();
```

๐ย**ะงัะพ ะฟัะพะธััะพะดะธั ะฟะพะด ะบะฐะฟะพัะพะผ?**

1. ะัย**ะทะฐะณััะทะธะปะธ ะพะฑัะตะบั**ย(ะพะฝ ะฑัะป ัะฟัะฐะฒะปัะตะผัะผ).
2. ะะฐะบััะปะธ ัะตััะธั โย**ะพะฑัะตะบั ััะฐะป "ะพััะพะตะดะธะฝัะฝะฝัะผ" (detached)**.
3. ะะทะผะตะฝะธะปะธ ะฟะพะปะตย`name`, ะฝะพ Hibernateย**ะฟะพะบะฐ ะฝะต ะทะฝะฐะตั ะพะฑ ััะพะผ**.
4. ะัะบััะปะธ ะฝะพะฒัั ัะตััะธั, ะฒัะทะฒะฐะปะธย`session.update(user);`ยโ Hibernateย**ัะฝะพะฒะฐ ะฝะฐัะฐะป ัะฟัะฐะฒะปััั ะพะฑัะตะบัะพะผ**.
5. ะัะธ ะบะพะผะผะธัะต Hibernateย**ััะฐะฒะฝะธะป ัะตะบััะตะต ัะพััะพัะฝะธะต ะพะฑัะตะบัะฐ ั ะะ**ยะธ ะพัะฟัะฐะฒะธะปย`UPDATE users SET name = 'ะะพะฒะพะต ะธะผั' WHERE id = 1`.

---

## **2๏ธโฃ ะะพะณะดะฐย`update()`ยะะ ัะฐะฑะพัะฐะตั?**

### โย**ะัะธะฑะบะฐ: ะพะฑะฝะพะฒะปะตะฝะธะต ะพะฑัะตะบัะฐ, ะบะพัะพัะพะณะพ ะฝะตั ะฒ ะะ**

ะัะปะธ ะพะฑัะตะบัะฐย**ะฒะพะพะฑัะต ะฝะตั ะฒ ะะ**, Hibernateย**ะฒัะฑัะพัะธั ะธัะบะปััะตะฝะธะต**:

```java
User user = new User();
user.setId(100); // ะะฑัะตะบัะฐ ั ัะฐะบะธะผ ID ะฒ ะะ ะฝะตั
user.setName("ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั");

session.update(user); // Hibernate ะฟะพะฟััะฐะตััั ัะดะตะปะฐัั UPDATE, ะฝะพ ะพะฑัะตะบัะฐ ะฝะตั!
```

**ะัะธะฑะบะฐ:**

```bash
org.hibernate.ObjectNotFoundException: No row with the given identifier exists
```

๐กย**ะะตัะตะฝะธะต:**ยะฟะตัะตะดย`update()`ย**ะฟัะพะฒะตัััั, ะตััั ะปะธ ะพะฑัะตะบั ะฒ ะะ**ยัะตัะตะทย`session.get()`.

---

### โย**ะัะธะฑะบะฐ: ะดะฒะฐ ัะฟัะฐะฒะปัะตะผัั ะพะฑัะตะบัะฐ ั ะพะดะฝะธะผ ID**

ะัะปะธ ะฒ ะพะดะฝะพะน ัะตััะธะธ ัะถะต ะตััั ะพะฑัะตะบั ั ัะตะผ ะถะต ID, ััะพ ะธ ั ะฟะตัะตะดะฐะฝะฝะพะณะพ ะฒย`update()`, Hibernate ะฒัะฑัะพัะธั ะพัะธะฑะบั:

```java
User user1 = session.get(User.class, 1); // ะะตัะฒัะน ะพะฑัะตะบั (ัะฟัะฐะฒะปัะตะผัะน)
User user2 = new User(); // ะัะพัะพะน ะพะฑัะตะบั (detached)
user2.setId(1);
user2.setName("ะััะณะพะต ะธะผั");

session.update(user2); // ะัะธะฑะบะฐ! ะะฒะฐ ะพะฑัะตะบัะฐ ั ะพะดะฝะธะผ ID
```

**ะัะธะฑะบะฐ:**
```bash
org.hibernate.NonUniqueObjectException: a different object with the same identifier value was already associated with the session
```

๐กย**ะะตัะตะฝะธะต:**

- ะัะฟะพะปัะทะพะฒะฐััย`merge()`ยะฒะผะตััะพย`update()`
- ะะปะธ ัะฝะฐัะฐะปะฐ ัะดะฐะปะธััย`user1`ยะธะท ัะตััะธะธ:

```java
session.evict(user1); // evict - ัะดะฐะปะตะฝะธะต ะพะฑัะตะบัะฐ ะธะท ัะตััะธะธ
session.update(user2);
```

---

## **3๏ธโฃย`update()`ยvsย`merge()`**

|ะะตัะพะด|ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั?|ะงัะพ ะดะตะปะฐะตั?|
|---|---|---|
|`update(entity)`|ะัะปะธย**ัะฒะตัะตะฝ, ััะพ ะพะฑัะตะบั ะตััั ะฒ ะะ**|**ะะตัะตะฒะพะดะธั detached-ะพะฑัะตะบั ะฒ managed-ัะพััะพัะฝะธะต**ยะธ ะฟัะธะผะตะฝัะตัย`UPDATE`|
|`merge(entity)`|ะัะปะธย**ะฝะต ัะฒะตัะตะฝ, ะตััั ะปะธ ะพะฑัะตะบั ะฒ ะะ**|ะัะปะธ ะพะฑัะตะบั ะตััั โย`UPDATE`, ะตัะปะธ ะฝะตั โย`INSERT`|

- ะัะปะธ ะพะฑัะตะบัย**ะตััั ะฒ ะะ**ยโย`UPDATE`.
- ะัะปะธ ะพะฑัะตะบัะฐย**ะฝะตั ะฒ ะะ**ยโย`INSERT`.

---

## **ะัะฒะพะด**

โย`update()`ย**ะฟะตัะตะฒะพะดะธั "ะพััะพะตะดะธะฝัะฝะฝัะน" ะพะฑัะตะบั ะพะฑัะฐัะฝะพ ะฒ ัะฟัะฐะฒะปัะตะผะพะต ัะพััะพัะฝะธะต**ยะธ ะฒัะฟะพะปะฝัะตัย`UPDATE`ยะฒ ะะ.  
โ ะัะฟะพะปัะทัะนย`update()`, ะตัะปะธย**ัะพัะฝะพ ะทะฝะฐะตัั, ััะพ ะพะฑัะตะบั ัะถะต ะตััั ะฒ ะะ**.  
โ ะัะปะธ ะพะฑัะตะบั ะผะพะถะตั ะพััััััะฒะพะฒะฐัั ะฒ ะะ, ะปัััะตย**ะธัะฟะพะปัะทะพะฒะฐััย`merge()`**.