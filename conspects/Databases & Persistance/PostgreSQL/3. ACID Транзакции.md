ACID - набор свойств, которые гарантируют надежность и целостность транзакций в БД. В PostgreSQL все транзакции по умолчанию ACID.
### **1 Atomicity (Атомарность)**

Транзакция состоит из нескольких операций, но либо все они выполняются успешно, либо все изменения откатываются

### **2 Consistency (Согласованность)**

После завершения транзакции БД остается корректной. То есть не нарушаются ограничения на уровне БД (типа связи между таблицам `FORIGN KEY`, уникальность записей и прочее)

### **3 Isolation (Изоляция)**

Параллельные транзакции не должны мешать друг другу. Если два пользователя одновременно изменяют данные, результат должен быть корректным

В Postgre используются **уровни изоляции транзакций** (например, `SERIALIZABLE`, `READ COMMITTED`, `REPEATABLE READ`)

### **4 Durability (Долговечность)**

Если транзакция завершилась и через секунду сервер помер - ее результат все равно сохранится 

**Пример:**  
Ты перевел деньги, и система выдала "Успешно". Через секунду сервер сломался, но после перезапуска твой перевод все равно останется.

**Как это достигается?**

- Базы данных используют **журналы транзакций (Write-Ahead Logging, WAL)**.
- Перед выполнением изменений данные записываются в журнал.
- Даже если сервер рухнет, он может восстановить последние успешные транзакции.

### Как работает Write-Ahead Logging?

1. **Запись в журнал перед изменениями в БД**:  
    Когда транзакция хочет изменить данные в базе, сначала все изменения записываются в специальный журнал (log), который хранит **информацию о сделанных изменениях** (например, старое и новое значения данных). **Только после этого** изменения применяются к основной базе данных.
    
2. **Журнал всегда записывается первым**: Это значит, что **журнал транзакций** записывается на диск **до** того, как сами изменения будут записаны в базу данных. Это важный момент, так как это позволяет восстановить состояние базы данных, если система аварийно завершит работу.
    
3. **Если система сбоит**, и транзакция не успела завершится (например, система отключилась до `COMMIT`), то можно использовать журнал для восстановления базы данных в **согласованном** состоянии.
    
    - Когда база перезапускается, она может пройти через журнал и **повторно применить изменения**, если транзакция была зафиксирована (`COMMIT`) или **откатить** изменения, если транзакция была отменена (`ROLLBACK`).

---

### Пример работы WAL

1. **Транзакция изменяет данные**: Допустим, транзакция хочет изменить баланс пользователя в таблице `accounts` из 5000 на 4000.
    
2. **Запись в журнал**: Перед тем, как сделать изменения в таблице, система записывает в журнал транзакций информацию о том, что значение было изменено с 5000 на 4000. Это может выглядеть как:

```sql
[START TRANSACTION] [UPDATE accounts SET balance = 4000 WHERE id = 1] - старое значение 5000
```
    
3. **Изменение в БД**: Теперь эти данные применяются к основной базе, и баланс пользователя изменяется.
    
4. **Подтверждение транзакции (COMMIT)**: Если транзакция завершена, то добавляется запись в журнал:
    
```sql
[COMMIT TRANSACTION]
```
    
5. **Восстановление после сбоя**: Если система упала до того, как транзакция была завершена, то при перезапуске базы можно проверить журнал:
    
    - Если транзакция была зафиксирована (`COMMIT`), то изменения из журнала применяются.
    - Если транзакция не успела закоммитится (`ROLLBACK`), то изменения откатываются.


