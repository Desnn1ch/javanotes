##  Общая характеристика

- **PostgreSQL** — объектно-реляционная СУБД (ORDBMS).
- Open-source
- Отличается от MySQL: более строгая, расширяемая, поддержка транзакций уровня **ACID** и сложных типов данных (JSON, массивы, гео).

- Работает по модели **client-server**.
- Каждый новый клиент = **новый процесс** на сервере.

### Чтобы было
- **Размер страницы (block)**: по умолчанию **8 KB** 
- Любая таблица/индекс = набор 8KB-страниц.
- У PostgreSQL **нет query-cache** как у MySQL. Кешируется **страницы** данных/индексов.

### Как работает кеширование
Кешируются именно **страницы данных и индексов**:
1. **Shared Buffers (внутренний кеш PostgreSQL)**
    - Каждый запрос читает данные **страницами** (по 8 KB).
    - Если нужная страница уже в `shared_buffers`, Postgres берёт её из RAM → «cache hit».
    - Если страницы нет → чтение с диска, затем кладётся в кеш.
2. **Page Cache ОС (OS cache)**
    - Даже если страница не в `shared_buffers`, но недавно читалась, ОС может держать её в своём файловом кеше.
    - Тогда чтение идёт не с диска, а тоже из RAM, но уже из ОС.

 Пример:
`SELECT * FROM users WHERE id = 123;`
 Планировщик определил: используем B-Tree индекс по `id`.
Postgres ищет нужные **страницы индекса**:
    - если они в shared_buffers → читаем из RAM;
    - если нет → тащим с диска, кладём в shared_buffers.
3. Индекс указывает на heap-страницу с реальной строкой.
4. Postgres подгружает эту страницу (из кеша или диска).
5. Возвращает результат.


##  Типы данных
- Стандартные: `INTEGER`, `VARCHAR`, `BOOLEAN`, `DATE/TIMESTAMP`.
- Массивы: `INTEGER[]`.
- JSON: `JSON`, `JSONB` (бинарный, индексируемый).
- Геоданные: `GEOMETRY`, `GEOGRAPHY` (через PostGIS).
- UUID.
- Собственные типы (можно создавать `ENUM`, composite types).

##  Индексы
- Улучшают скорость поиска, но замедляют изменения. 
- Типы:
    - **B-Tree** (по умолчанию, универсальные).
    - **Hash** (только `=`).
    - **GIN** (JSONB, массивы, full-text).
    - **GiST** (гео, текст, сложные структуры).
    - **BRIN** (большие таблицы с упорядоченными данными).
    - **Partial** (по условию).
    - **Composite** (несколько колонок).

| Тип индекса | Когда использовать                                        |
| ----------- | --------------------------------------------------------- |
| **B-Tree**  | почти всегда: `=`, `<`, `>`, `ORDER BY`, `JOIN`           |
| **Hash**    | только `=` (и то редко, в PG почти не нужен)              |
| **GIN**     | JSONB, массивы, полнотекстовый поиск                      |
| **GiST**    | геоданные, поиск по близости                              |
| **BRIN**    | большие таблицы, упорядоченные данные (логи, time-series) |
Проверить запрос можно через: `EXPLAIN ANALYZE `


**ACID** — это свойства транзакций в СУБД. Если база поддерживает ACID, это значит, что данные надёжно хранятся и не ломаются даже при сбоях.

---
### ACID расшифровка
1. **A — Atomicity (Атомарность)**
    - Транзакция выполняется **либо полностью, либо никак**.
    - Если одно из действий упало → всё откатывается.  
        ✅ Пример: перевод денег. Если со счёта А списали, но на счёт B не зачислили — транзакция должна откатиться.
---
2. **C — Consistency (Согласованность)**
    - После транзакции база всегда остаётся в **корректном состоянии**, которое соответствует правилам и ограничениям (PK, FK, CHECK, триггеры).  
        ✅ Пример: нельзя вставить заказ с несуществующим пользователем.
---
3. **I — Isolation (Изолированность)**
    - Одновременные транзакции не мешают друг другу.
    - СУБД гарантирует, что результат будет таким же, как если бы они выполнялись последовательно.  
        ✅ Пример: два клиента списывают деньги с одного счёта → изоляция не должна привести к «дважды потраченным» деньгам.
---
4. **D — Durability (Надёжность, долговечность)**
    - После коммита изменения **не пропадут**, даже если сервер упадёт.
    - В PostgreSQL это обеспечивается через WAL (Write-Ahead Log).  
        ✅ Пример: если база зафиксировала перевод, деньги не исчезнут после рестарта.
---

### Кратко и по делу
ACID = **надёжные транзакции**.
- Atomicity = всё или ничего.
- Consistency = данные всегда валидны.
- Isolation = параллельные операции не мешают.
- Durability = не теряются после сбоя.

---

