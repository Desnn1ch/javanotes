Почему бы нам `wait()` не вызывать с помощью `if`? Зачем мы используем `while`?

```java
public synchronized void produce(final Message message) {  
    try {  
        while (messagesToBeConsumed.size() >= maxStoredMessages) {  
            wait();  
        }        messagesToBeConsumed.add(message);  
        out.printf(MESSAGE_OF_MESSAGE_IS_PRODUCED, message);  
        notifyAll();  
    } catch (InterruptedException e) {  
        Thread.currentThread().interrupt();  
    }
}
```

Представим снова вот такую ситуацию. Два потока ждут, один работает:
![[Screenshot 2025-08-25 at 21.49.42.png]]

Итак, П1 положил элемент и разбудил П2. П2 по идее должен продолжить работу с того места, откуда он встал на паузу с прошлого раза. И если бы там был `if`, тогда П2 еще раз положил бы элемент в брокер, нарушив при этом бизнес-идею.
![[Screenshot 2025-08-25 at 21.51.05.png]]

Поэтому в этом случае следует обернуть `wait()` в `while`.

### А что если нам нужно ограниченное время ожидания?

На помощь нам приходит перегруженная версия метода `wait()` - `wait(long timeoutMillis)`. Если его так никто и не разбудил спустя `timoutMillis` времени, он проснется сам и продолжит конкурировать за монитор объекта. После того как он выиграет конкуренцию - он продолжит с той строки на которой уснул.