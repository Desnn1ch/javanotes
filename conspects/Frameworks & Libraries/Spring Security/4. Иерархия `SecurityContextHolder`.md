
```scss
┌───────────────────────────────┐
│ SecurityContextHolder         │  ← глобальное хранилище (ThreadLocal)
│   getContext()                │
└───────────────┬───────────────┘
                │
┌───────────────▼───────────────┐
│ SecurityContext               │  ← одна "сессия безопасности"
│   Authentication auth         │
└───────────────┬───────────────┘
                │
┌───────────────▼───────────────┐
│ Authentication                │  ← кто пользователь и как вошёл
│  - Principal (UserDetails/Jwt)│
│  - Credentials (пароль/токен) │
│  - Authorities (роли/права)   │
│  - isAuthenticated            │
└───────────────┬───────────────┘
                │
   ┌────────────▼────────────┐
   │ Principal (UserDetails) │ ← сам пользователь
   └────────────┬────────────┘
                │
   ┌────────────▼────────────┐
   │ GrantedAuthority         │ ← права (ROLE_USER, ROLE_ADMIN)
   └─────────────────────────┘
```

#### 1. **`SecurityContextHolder`**

- Статический "глобальный доступ" к текущему контексту безопасности.
- Обычно использует `ThreadLocal`, чтобы у каждого запроса был свой `SecurityContext`.
- Методы:
```java
SecurityContext context = SecurityContextHolder.getContext();
SecurityContextHolder.setContext(context);
SecurityContextHolder.clearContext();
```

#### 2. **`SecurityContext`**

- Контейнер для одного объекта `Authentication`.
- Интерфейс, стандартная реализация — `SecurityContextImpl`.
- Обычно хранится в `HttpSession` между запросами.
- Содержит `Authentification`

#### 3. **`Authentication`**

- Центральный объект, описывающий **кто пользователь и его статус аутентификации**.
- Методы:
    - `getPrincipal()` — объект пользователя.
    - `getCredentials()` — "секрет" (пароль/токен).
    - `getAuthorities()` — список прав (`GrantedAuthority`).
    - `isAuthenticated()` — прошёл ли проверку.
    
- Важные реализации:
    - `UsernamePasswordAuthenticationToken` — для username/password.
    - `JwtAuthenticationToken` — для JWT.
    - `AnonymousAuthenticationToken` — для анонимных пользователей.


#### 4. **`Principal` (обычно `UserDetails`)**

- Сам пользователь.
- Может быть:
    - объект, реализующий `UserDetails` (часто через `User` из `spring-security-core`),
    - `Jwt` (если используется JWT),
    - кастомный класс.

###### `UserDetails`

- интерфейс, который описывает бизнес-пользователя.
- поля:
    - `getUsername()`
    - `getPassword()`
    - `getAuthorities()`
    - `isAccountNonLocked()`
    - `isEnabled()`

###### `User`
- стандартная реализация `UserDetails`.

#### 5. **`GrantedAuthority` (Роли/Права)**

- Интерфейс, описывающий одно право (например `"ROLE_ADMIN"`, `"READ_PRIVILEGE"`).
- Обычно это обёртка вокруг строки.
- Хранятся внутри `Authentication`.

#### 6. **`Credentials`**

- Секрет, на основании которого прошла аутентификация (пароль, токен).
- После успешной аутентификации Spring часто затирает их (`null`), чтобы не хранить лишнего в памяти.

#### Итог

- **`SecurityContextHolder`** — точка входа, статическое API.
- **`SecurityContext`** — контейнер с одной текущей аутентификацией.
- **`Authentication`** — объект аутентификации (состояние входа).
- **`Principal` (UserDetails/Jwt)** — сам пользователь.
- **`GrantedAuthority`** — роли/права.
- **`Credentials`** — пароль/токен (обычно очищаются после входа).