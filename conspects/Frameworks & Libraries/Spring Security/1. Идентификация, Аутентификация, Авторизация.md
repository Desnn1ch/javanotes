**Идентификация** — заявление о том, кем пользователь является (имя/почта)

**Аутентификация** — предоставление доказательств о том, что ты - это ты (когда не голоден) (пароль/отпечаток пальца)

**Авторизация** — проверка и предоставление доступа к запрашиваемому ресурсу (вы есть в базе)

## **Решения для аутентификации и авторизации запросов**

### 1 **Аутентификация по паролю**

Тупо username + password. Протоколы для такой аутентификации:

##### **HTTP authentication**:

при обращении к защищенному ресурсу отсылается 401 Unauthorized, и возможно автоматически перенаправление на страницу логина. После авторизации во всех последующих запросах браузер автоматически добавляет в запрос заголовок `Authorization`, в котором передаются данные пользователя для аутентификации сервером.
##### **Forms authentication:**

буквально форма в которую вводится юзернейм+пасворд, и отправляется HTTP POST запрос для аутентификации. В случае успеха создается session token в cookies браузера. При следующих запросах session token автоматически передается на сервер для авторизации запроса.
###### Как это работает

1 **Логин**  - Пользователь вводит логин/пароль в форму.

2 **Сервер создаёт запись в сессиях** и хранится это в памяти, Redis или БД.
Например:
```json
{
  "session_id": "abc123xyz",
  "user_id": 42,
  "created_at": "2025-08-31T15:00Z"
}
	```

3 **Сервер отдаёт cookie клиенту** - `Set-Cookie: JSESSIONID=abc123xyz; HttpOnly; Secure; Path=/`

4 **В дальнейшие запросы клиента**  браузер автоматически прикладывает cookie: `GET /profile HTTP/1.1 Cookie: JSESSIONID=abc123xyz`

5 **Сервер ищет session_id в своей таблице сессий**
- Если находит → понимает, что это запрос от пользователя с id=42.
- Если не находит → значит сессия истекла или недействительна → нужно логиниться заново.

###### Session vs Token

|                  | Session ID (classic)                                                                                          | Token (JWT, OAuth2)                       |
| ---------------- | ------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| Где хранится     | На сервере (таблица сессий)                                                                                   | Только у клиента (в JWT)                  |
| Масштабируемость | хуже (нужно шарить сессии между серверами, при условии, когда запрос может отправиться на несколько серверов) | лучше (без state на сервере)              |
| Безопасность     | cookie с рандомным ID                                                                                         | токен с подписью                          |
| Инвалидация      | просто удалить запись в БД                                                                                    | сложно (нужно blacklist или короткий TTL) |

### 2 **Аутентификация с помощью токенов**

Чаще всего применяется при построении распределенных систем Single Sign-On (SSO) где за аутентификацию отвечает какой-то отдельный сервис (например если вы регистрируетесь на сайте через Google-аккаунт)

_Note_: SSO — это механизм, позволяющий пользователю один раз пройти аутентификацию и затем использовать один и тот же логин для доступа к нескольким независимым приложениям или сервисам.

Суть в том, что есть Identity Provider (IP), который предоставляет сведения о пользователе в **виде токена**, а есть Service Provider (SP), который запрашивает этот токен и использует его для аутентификации-авторизации.
![[Screenshot 2025-08-31 at 16.38.57.png]]

Есть стандарты, определяющие протокол взаимодействия между клиентами и IP/SP приложениями, а также определяющие формат поддерживаемых токенов.
##### **OAuth (Open Authentication)**

Описывает механизм получения доступа одного приложения к другому от имени пользователя. Нужно, чтобы разные сервисы могли быть использованы другими сервисами. Ну например сайт [milfsaround.com](http://milfsaround.com/) захотел порыться у вас в мейл.ру почте, вы говорите ему типа давай брат, делай.

Че происходит под капотом:

1. Пользователь aka Resource Owner (ну ты) дает разрешение приложению aka Client (ну milfsaround) на доступ к определенному ресурсу в виде гранта (грант задает вид доступа который вы хотите дать)
2. Приложение aka Client (milfsaround) обращается к серверу авторизации (Authentication Server мейла) и получает токен доступа к ресурсу в обмен на грант.
3. Приложение использует полученный токен для получения данных от сервера ресурсов aka Resource Server (ну майл.ру почта ваша).

![[Screenshot 2025-08-31 at 17.50.41.png]]

### 3 Аутентификация по сертификату

че то на суперкрутом и защищенном. ну генерируется сертификат, он подтверждается кем-то крутым, и сайты, которые поддерживают такую аутентификацию, верят сертификату.

### 4 Одноразовые пароли

Two-factor authentication — генерируется одноразовый пароль. собсна говоря да, как то так.

### 5 Аутентификация по ключам доступа

Это когда вы пытались взломать какое нибудь очередное 300 bucks / week приложение от адоба которое просило ключ, или например вот как раньше на дисках с играми на рынке ключи смешные внутри упаковочки были. ввооооооооооот.